!function(t,s){"object"==typeof exports&&"object"==typeof module?module.exports=s():"function"==typeof define&&define.amd?define([],s):"object"==typeof exports?exports.suz=s():t.suz=s()}("undefined"!=typeof window?window:this,function(){return function(t){var s={};function i(e){if(s[e])return s[e].exports;var h=s[e]={i:e,l:!1,exports:{}};return t[e].call(h.exports,h,h.exports,i),h.l=!0,h.exports}return i.m=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var h in t)i.d(e,h,function(s){return t[s]}.bind(null,h));return e},i.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.p="",i(i.s=0)}([function(t,s,i){"use strict";i.r(s);class e{constructor(t=0,s=0){this.x=t,this.y=s,this.dims=2}add(t){return new e(this.x+t.x,this.y+t.y)}sub(t){return new e(this.x-t.x,this.y-t.y)}mul(t){return new e(this.x*t.x,this.y*t.y)}times(t){return new e(this.x*t,this.y*t)}div(t){return new e(this.x/t.x,this.y/t.y)}dot(t){return this.x*t.x+this.y*t.y}mag(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}normalize(){return this.times(1/this.mag())}reflect(t){return t.times(2*this.dot(t)).sub(this)}addTimes(t,s){return new e(this.x+t.x*s,this.y+t.y*s)}equals(t,s=d){return Math.abs(this.x-t.x)<s&&Math.abs(this.y-t.y)<s}}class h{constructor(t=0,s=0,i=0){this.x=t,this.y=s,this.z=i,this.dims=3}add(t){return new h(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new h(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return new h(this.x*t.x,this.y*t.y,this.z*t.z)}times(t){return new h(this.x*t,this.y*t,this.z*t)}div(t){return new h(this.x/t.x,this.y/t.y,this.z/t.z)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}mag(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.times(1/this.mag())}reflect(t){return t.times(2*this.dot(t)).sub(this)}addTimes(t,s){return new h(this.x+t.x*s,this.y+t.y*s,this.z+t.z*s)}equals(t,s=d){return Math.abs(this.x-t.x)<s&&Math.abs(this.y-t.y)<s&&Math.abs(this.z-t.z)<s}get r(){return this.x}set r(t){this.x=t}get g(){return this.y}set g(t){this.y=t}get b(){return this.z}set b(t){this.z=t}}class r{constructor(t){if(t.length<4)throw new Error(`Cannot construct a VecN with less than 4 elements, got : ${t}`);this._values=t instanceof Float32Array?t:new Float32Array(t),this._dims=t.length}add(t){const s=new r(this._values);for(let i=0;i<this._dims;i++)s._values[i]+=t._values[i];return s}sub(t){const s=new r(this._values);for(let i=0;i<this._dims;i++)s._values[i]-=t._values[i];return s}mul(t){const s=new r(this._values);for(let i=0;i<this._dims;i++)s._values[i]*=t._values[i];return s}times(t){const s=new r(this._values);for(let i=0;i<this._dims;i++)s._values[i]*=t;return s}div(t){const s=new r(this._values);for(let i=0;i<this._dims;i++)s._values[i]/=t._values[i];return s}dot(t){let s=0;for(let i=0;i<this._dims;i++)s+=this._values[i]*t._values[i];return s}mag(){let t=0;for(let s=0;s<this._dims;s++)t+=Math.pow(this._values[s],2);return Math.sqrt(t)}normalize(){return this.times(1/this.mag())}reflect(t){return t.times(2*this.dot(t)).sub(this)}addTimes(t,s){const i=new r(this._values);for(let e=0;e<this._dims;e++)i._values[e]=i._values[e]+t._values[e]*s;return i}equals(t,s=d){if(this._dims!==t._dims)return!1;for(let i=0;i<this._dims;i++)if(Math.abs(this._values[i]-t._values[i])>s)return!1;return!0}get dims(){return this._dims}get values(){return this._values}set values(t){this._values=t,this._dims=t.length}get r(){return this._values[0]}get x(){return this._values[0]}set r(t){this._values[0]=t}set x(t){this._values[0]=t}get g(){return this._values[1]}get y(){return this._values[1]}set g(t){this._values[1]=t}set y(t){this._values[1]=t}get b(){return this._values[2]}get z(){return this._values[2]}set b(t){this._values[2]=t}set z(t){this._values[2]=t}get a(){return this._values[3]}get w(){return this._values[3]}set a(t){this._values[3]=t}set w(t){this._values[3]=t}}class n{constructor(t){if(void 0!==t){if(16!==t.length)throw new Error(`Matrix4 constructor requires a Float32Array with 16 elements, got ${t.length}`);this._m=t}else this._m=new Float32Array(16),this.identity()}identity(){return this._m.fill(0),this._m[0]=1,this._m[5]=1,this._m[10]=1,this._m[15]=1,this}fill(t){this._m.fill(t)}mul(t){const s=new n,i=t._m;return s._m[0]=this._m[0]*i[0]+this._m[1]*i[4]+this._m[2]*i[8]+this._m[3]*i[12],s._m[1]=this._m[0]*i[1]+this._m[1]*i[5]+this._m[2]*i[9]+this._m[3]*i[13],s._m[2]=this._m[0]*i[2]+this._m[1]*i[6]+this._m[2]*i[10]+this._m[3]*i[14],s._m[3]=this._m[0]*i[3]+this._m[1]*i[7]+this._m[2]*i[11]+this._m[3]*i[15],s._m[4]=this._m[4]*i[0]+this._m[5]*i[4]+this._m[6]*i[8]+this._m[7]*i[12],s._m[5]=this._m[4]*i[1]+this._m[5]*i[5]+this._m[6]*i[9]+this._m[7]*i[13],s._m[6]=this._m[4]*i[2]+this._m[5]*i[6]+this._m[6]*i[10]+this._m[7]*i[14],s._m[7]=this._m[4]*i[3]+this._m[5]*i[7]+this._m[6]*i[11]+this._m[7]*i[15],s._m[8]=this._m[8]*i[0]+this._m[9]*i[4]+this._m[10]*i[8]+this._m[11]*i[12],s._m[9]=this._m[8]*i[1]+this._m[9]*i[5]+this._m[10]*i[9]+this._m[11]*i[13],s._m[10]=this._m[8]*i[2]+this._m[9]*i[6]+this._m[10]*i[10]+this._m[11]*i[14],s._m[11]=this._m[8]*i[3]+this._m[9]*i[7]+this._m[10]*i[11]+this._m[11]*i[15],s._m[12]=this._m[12]*i[0]+this._m[13]*i[4]+this._m[14]*i[8]+this._m[15]*i[12],s._m[13]=this._m[12]*i[1]+this._m[13]*i[5]+this._m[14]*i[9]+this._m[15]*i[13],s._m[14]=this._m[12]*i[2]+this._m[13]*i[6]+this._m[14]*i[10]+this._m[15]*i[14],s._m[15]=this._m[12]*i[3]+this._m[13]*i[7]+this._m[14]*i[11]+this._m[15]*i[15],s}translate(t){const s=new Float32Array(this._m);return s[3]=this._m[3]+this._m[0]*t.x+this._m[1]*t.y+this._m[2]*t.z,s[7]=this._m[7]+this._m[4]*t.x+this._m[5]*t.y+this._m[6]*t.z,s[11]=this._m[11]+this._m[8]*t.x+this._m[9]*t.y+this._m[10]*t.z,s[15]=this._m[15]+this._m[12]*t.x+this._m[13]*t.y+this._m[14]*t.z,this._m=s,this}rotateX(t){const s=new Float32Array(16),i=Math.cos(t),e=Math.sin(t);return s[0]=this._m[0],s[1]=this._m[1]*i+this._m[2]*e,s[2]=this._m[2]*i-this._m[1]*e,s[3]=this._m[3],s[4]=this._m[4],s[5]=this._m[5]*i+this._m[6]*e,s[6]=this._m[6]*i-this._m[5]*e,s[7]=this._m[7],s[8]=this._m[8],s[9]=this._m[9]*i+this._m[10]*e,s[10]=this._m[10]*i-this._m[9]*e,s[11]=this._m[11],s[12]=this._m[12],s[13]=this._m[13]*i+this._m[14]*e,s[14]=this._m[14]*i-this._m[13]*e,s[15]=this._m[15],this._m=s,this}rotateY(t){const s=new Float32Array(16),i=Math.cos(t),e=Math.sin(t);return s[0]=this._m[0]*i-this._m[2]*e,s[1]=this._m[1],s[2]=this._m[2]*i+this._m[0]*e,s[3]=this._m[3],s[4]=this._m[4]*i-this._m[6]*e,s[5]=this._m[5],s[6]=this._m[6]*i+this._m[4]*e,s[7]=this._m[7],s[8]=this._m[8]*i-this._m[10]*e,s[9]=this._m[9],s[10]=this._m[10]*i+this._m[8]*e,s[11]=this._m[11],s[12]=this._m[12]*i-this._m[14]*e,s[13]=this._m[13],s[14]=this._m[14]*i+this._m[12]*e,s[15]=this._m[15],this._m=s,this}rotateZ(t){const s=new Float32Array(16),i=Math.cos(t),e=Math.sin(t);return s[0]=this._m[0]*i+this._m[1]*e,s[1]=this._m[1]*i-this._m[0]*e,s[2]=this._m[2],s[3]=this._m[3],s[4]=this._m[4]*i+this._m[5]*e,s[5]=this._m[5]*i-this._m[4]*e,s[6]=this._m[6],s[7]=this._m[7],s[8]=this._m[8]*i+this._m[9]*e,s[9]=this._m[9]*i-this._m[8]*e,s[10]=this._m[10],s[11]=this._m[11],s[12]=this._m[12]*i+this._m[13]*e,s[13]=this._m[13]*i-this._m[12]*e,s[14]=this._m[14],s[15]=this._m[15],this._m=s,this}transform(t){const s=t instanceof f?t.w:1;return new f(this._m[0]*t.x+this._m[1]*t.y+this._m[2]*t.z+this._m[3]*s,this._m[4]*t.x+this._m[5]*t.y+this._m[6]*t.z+this._m[7]*s,this._m[8]*t.x+this._m[9]*t.y+this._m[10]*t.z+this._m[11]*s,this._m[12]*t.x+this._m[13]*t.y+this._m[14]*t.z+this._m[15]*s)}det(){return this._m[1]*this._m[11]*this._m[14]*this._m[4]-this._m[1]*this._m[10]*this._m[15]*this._m[4]-this._m[11]*this._m[13]*this._m[2]*this._m[4]+this._m[10]*this._m[13]*this._m[3]*this._m[4]-this._m[0]*this._m[11]*this._m[14]*this._m[5]+this._m[0]*this._m[10]*this._m[15]*this._m[5]+this._m[11]*this._m[12]*this._m[2]*this._m[5]-this._m[10]*this._m[12]*this._m[3]*this._m[5]-this._m[1]*this._m[11]*this._m[12]*this._m[6]+this._m[0]*this._m[11]*this._m[13]*this._m[6]+this._m[1]*this._m[10]*this._m[12]*this._m[7]-this._m[0]*this._m[10]*this._m[13]*this._m[7]-this._m[15]*this._m[2]*this._m[5]*this._m[8]+this._m[14]*this._m[3]*this._m[5]*this._m[8]+this._m[1]*this._m[15]*this._m[6]*this._m[8]-this._m[13]*this._m[3]*this._m[6]*this._m[8]-this._m[1]*this._m[14]*this._m[7]*this._m[8]+this._m[13]*this._m[2]*this._m[7]*this._m[8]+this._m[15]*this._m[2]*this._m[4]*this._m[9]-this._m[14]*this._m[3]*this._m[4]*this._m[9]-this._m[0]*this._m[15]*this._m[6]*this._m[9]+this._m[12]*this._m[3]*this._m[6]*this._m[9]+this._m[0]*this._m[14]*this._m[7]*this._m[9]-this._m[12]*this._m[2]*this._m[7]*this._m[9]}invert(){const t=this.det(),s=new n;return s._m[0]=(-this._m[11]*this._m[14]*this._m[5]+this._m[10]*this._m[15]*this._m[5]+this._m[11]*this._m[13]*this._m[6]-this._m[10]*this._m[13]*this._m[7]-this._m[15]*this._m[6]*this._m[9]+this._m[14]*this._m[7]*this._m[9])/t,s._m[1]=(this._m[1]*this._m[11]*this._m[14]-this._m[1]*this._m[10]*this._m[15]-this._m[11]*this._m[13]*this._m[2]+this._m[10]*this._m[13]*this._m[3]+this._m[15]*this._m[2]*this._m[9]-this._m[14]*this._m[3]*this._m[9])/t,s._m[2]=(-this._m[15]*this._m[2]*this._m[5]+this._m[14]*this._m[3]*this._m[5]+this._m[1]*this._m[15]*this._m[6]-this._m[13]*this._m[3]*this._m[6]-this._m[1]*this._m[14]*this._m[7]+this._m[13]*this._m[2]*this._m[7])/t,s._m[3]=(this._m[11]*this._m[2]*this._m[5]-this._m[10]*this._m[3]*this._m[5]-this._m[1]*this._m[11]*this._m[6]+this._m[1]*this._m[10]*this._m[7]+this._m[3]*this._m[6]*this._m[9]-this._m[2]*this._m[7]*this._m[9])/t,s._m[4]=(this._m[11]*this._m[14]*this._m[4]-this._m[10]*this._m[15]*this._m[4]-this._m[11]*this._m[12]*this._m[6]+this._m[10]*this._m[12]*this._m[7]+this._m[15]*this._m[6]*this._m[8]-this._m[14]*this._m[7]*this._m[8])/t,s._m[5]=(-this._m[0]*this._m[11]*this._m[14]+this._m[0]*this._m[10]*this._m[15]+this._m[11]*this._m[12]*this._m[2]-this._m[10]*this._m[12]*this._m[3]-this._m[15]*this._m[2]*this._m[8]+this._m[14]*this._m[3]*this._m[8])/t,s._m[6]=(this._m[15]*this._m[2]*this._m[4]-this._m[14]*this._m[3]*this._m[4]-this._m[0]*this._m[15]*this._m[6]+this._m[12]*this._m[3]*this._m[6]+this._m[0]*this._m[14]*this._m[7]-this._m[12]*this._m[2]*this._m[7])/t,s._m[7]=(-this._m[11]*this._m[2]*this._m[4]+this._m[10]*this._m[3]*this._m[4]+this._m[0]*this._m[11]*this._m[6]-this._m[0]*this._m[10]*this._m[7]-this._m[3]*this._m[6]*this._m[8]+this._m[2]*this._m[7]*this._m[8])/t,s._m[8]=(-this._m[11]*this._m[13]*this._m[4]+this._m[11]*this._m[12]*this._m[5]-this._m[15]*this._m[5]*this._m[8]+this._m[13]*this._m[7]*this._m[8]+this._m[15]*this._m[4]*this._m[9]-this._m[12]*this._m[7]*this._m[9])/t,s._m[9]=(-this._m[1]*this._m[11]*this._m[12]+this._m[0]*this._m[11]*this._m[13]+this._m[1]*this._m[15]*this._m[8]-this._m[13]*this._m[3]*this._m[8]-this._m[0]*this._m[15]*this._m[9]+this._m[12]*this._m[3]*this._m[9])/t,s._m[10]=(-this._m[1]*this._m[15]*this._m[4]+this._m[13]*this._m[3]*this._m[4]+this._m[0]*this._m[15]*this._m[5]-this._m[12]*this._m[3]*this._m[5]+this._m[1]*this._m[12]*this._m[7]-this._m[0]*this._m[13]*this._m[7])/t,s._m[11]=(this._m[1]*this._m[11]*this._m[4]-this._m[0]*this._m[11]*this._m[5]+this._m[3]*this._m[5]*this._m[8]-this._m[1]*this._m[7]*this._m[8]-this._m[3]*this._m[4]*this._m[9]+this._m[0]*this._m[7]*this._m[9])/t,s._m[12]=(this._m[10]*this._m[13]*this._m[4]-this._m[10]*this._m[12]*this._m[5]+this._m[14]*this._m[5]*this._m[8]-this._m[13]*this._m[6]*this._m[8]-this._m[14]*this._m[4]*this._m[9]+this._m[12]*this._m[6]*this._m[9])/t,s._m[13]=(this._m[1]*this._m[10]*this._m[12]-this._m[0]*this._m[10]*this._m[13]-this._m[1]*this._m[14]*this._m[8]+this._m[13]*this._m[2]*this._m[8]+this._m[0]*this._m[14]*this._m[9]-this._m[12]*this._m[2]*this._m[9])/t,s._m[14]=(this._m[1]*this._m[14]*this._m[4]-this._m[13]*this._m[2]*this._m[4]-this._m[0]*this._m[14]*this._m[5]+this._m[12]*this._m[2]*this._m[5]-this._m[1]*this._m[12]*this._m[6]+this._m[0]*this._m[13]*this._m[6])/t,s._m[15]=(-this._m[1]*this._m[10]*this._m[4]+this._m[0]*this._m[10]*this._m[5]-this._m[2]*this._m[5]*this._m[8]+this._m[1]*this._m[6]*this._m[8]+this._m[2]*this._m[4]*this._m[9]-this._m[0]*this._m[6]*this._m[9])/t,s}static scale(...t){let s,i,e;1===t.length&&("number"==typeof t[0]?(i=s=t[0],e=s):(s=t[0].x,i=t[0].y,e=t[0].z));const h=new n;return h._m[0]=s,h._m[5]=i,h._m[10]=e,h._m[15]=1,h}static perspective(t,s,i,e){const h=new n,r=Math.tan(t/2),_=i-e;return h._m[0]=1/(r*s),h._m[5]=1/r,h._m[10]=(-i-e)/_,h._m[11]=2*e*i/_,h._m[14]=1,h._m[15]=0,h}static screenSpace(t,s){const i=new n,e=t/2,h=s/2;return i._m[0]=e,i._m[3]=e,i._m[5]=h,i._m[7]=h,i}static translation(t){const s=new n;return s._m[3]=t.x,s._m[7]=t.y,s._m[11]=t.z,s}}function _(...t){switch(t.length){case 0:return new e(0,0);case 1:return"number"==typeof t[0]?new e(t[0],t[0]):new e(t[0].x,t[0].y);case 2:default:return new e(t[0],t[1])}}function m(...t){switch(t.length){case 0:return new h(0,0,0);case 1:if("number"==typeof t[0])return new h(t[0],t[0],t[0]);switch(t[0].dims){case 2:return new f(t[0].x,t[0].y,0);case 3:case 4:default:return new h(t[0].x,t[0].y,t[0].z)}case 2:return new h(t[0],t[1],0);default:return new h(t[0],t[1],t[2])}}function a(...t){switch(t.length){case 0:return new f(0,0,0,0);case 1:if("number"==typeof t[0])return new f(t[0],t[0],t[0],t[0]);switch(t[0].dims){case 2:return new f(t[0].x,t[0].y,t[0].x,t[0].y);case 3:return new f(t[0].x,t[0].y,t[0].z,1);case 4:return new f(t[0].x,t[0].y,t[0].x,t[0].y);default:if(t[0]instanceof r){const[s,i,e,h]=t[0].values;return new f(s,i,e,h)}throw new Error(`Unexpected vec4 argument: ${t[0]}`)}case 2:if(t[0]instanceof h){const s=t[0];return new f(s.x,s.y,s.z,t[1])}{const[s,i]=t;return new f(s,i,s,i)}case 3:return new f(t[0],t[1],t[2],1);default:return new f(t[0],t[1],t[2],t[3])}}const o=(...t)=>new r(t);function c(...t){switch(t.length){case 2:return new e(t[0],t[1]);case 3:return new h(t[0],t[1],t[2]);case 4:return new f(t[0],t[1],t[2],t[3]);default:return new r(t)}}function u(...t){if(0===t.length)return new n;if("number"==typeof t[0]){if(1===t.length)return n.scale(t[0]);if(16===t.length)return new n(new Float32Array(t))}if(t[0]instanceof Float32Array)return new n(t[0]);if(t[0]instanceof f&&4===t.length){const[s,i,e,h]=t;return new n(new Float32Array([s.x,s.y,s.z,s.w,i.x,i.y,i.z,i.w,e.x,e.y,e.z,e.w,h.x,h.y,h.z,h.w]))}throw new Error(`Unexpected arguments for mat4: ${t}`)}const d=Math.pow(10,-6);function l(t,s){if("string"!=typeof s)return;const i=t[s];if(i instanceof Function)return i;const e=s.split("");if(s.length>1&&s.length<5){const s=e.map(s=>t[s]);return 1===s.length?s[0]:c(...s)}return i}function y(t,s){return void 0!==s?l(t,s):new Proxy(t,{get:l})}class f{constructor(t=0,s=0,i=0,e=1){this.x=t,this.y=s,this.z=i,this.w=e,this.dims=4}add(t){return new f(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}sub(t){return new f(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}mul(t){return new f(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)}times(t){return new f(this.x*t,this.y*t,this.z*t,this.w*t)}div(t){return new f(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}mag(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2)+Math.pow(this.w,2))}normalize(){return this.times(1/this.mag())}reflect(t){return t.times(2*this.dot(t)).sub(this)}addTimes(t,s){return new f(this.x+t.x*s,this.y+t.y*s,this.z+t.z*s,this.w+t.w*s)}equals(t,s=d){return Math.abs(this.x-t.x)<s&&Math.abs(this.y-t.y)<s&&Math.abs(this.z-t.z)<s&&Math.abs(this.w-t.w)<s}get r(){return this.x}set r(t){this.x=t}get g(){return this.y}set g(t){this.y=t}get b(){return this.z}set b(t){this.z=t}get a(){return this.w}set a(t){this.w=t}}function g(t){return new f((t>>16&255)/255,(t>>8&255)/255,(255&t)/255,1)}const x={transparent:new f(0,0,0,0),black:g(0),white:g(16777215),red:g(16711680),green:g(65280),blue:g(255),yellow:g(16776960),cyan:g(65535),pink:g(16711935),orange:g(16747520),rand:()=>g(Math.floor(16777216*Math.random())),css:void 0};"undefined"!=typeof window&&(x.css=function(t=100){const s=document.createElement("canvas");s.width=1,s.height=1;const i=s.getContext("2d"),e=new Map;return s=>{if(e.has(s))return e.get(s);i.fillStyle=s,i.fillRect(0,0,1,1),i.fill();const[h,r,n,_]=i.getImageData(0,0,1,1).data,m=new f(h/255,r/255,n/255,_/255);return e.size===t&&e.delete(e.keys().next().value),e.set(s,m),m}}());const w=t=>57.29577951308232*t%360,v=t=>.017453292519943295*t%6.283185307179586,p=(t,s,i)=>Math.max(Math.min(t,i),s);function b(t,s,i){return(s.x-t.x)*(i.y-t.y)-(i.x-t.x)*(s.y-t.y)}function z(t,s){return"number"==typeof t?t+s:t.add(s)}function M(t,s){return"number"==typeof t?t*s:t.times(s)}function T(t,s){return"number"==typeof t?t*s:t.mul(s)}function A(t,s,i){return"number"==typeof t?t+s*i:t.addTimes(s,i)}function E(t,s){t.set(s);const i=t.length;let e=s.length;for(;e<i;)t.copyWithin(e,0,e),e<<=1;return t}class k{constructor(t,s){this._data=new Uint8ClampedArray(t*s*4),this._width=t,this._height=s}clear(t=x.black){E(this.data,[255*t.r,255*t.g,255*t.b,255*t.a])}_set(t,s,i){const e=4*(t+s*this._width);this._data[e]=255*i.r,this._data[e+1]=255*i.g,this._data[e+2]=255*i.b,this._data[e+3]=255*i.a}get width(){return this._width}get height(){return this._height}get data(){return this._data}at(t,s){const i=4*(t+s*this._width);return new f(this._data[i]/255,this._data[i+1]/255,this._data[i+2]/255,this._data[i+3]/255)}static fromImageData(t){const s=new k(t.width,t.height);return s._data.set(t.data),s}static fromImage(t){const s=document.createElement("canvas").getContext("2d");return s.canvas.width=t.width,s.canvas.height=t.height,s.drawImage(t,0,0),k.fromImageData(s.getImageData(0,0,t.width,t.height))}static fromFile(t){if("undefined"!=typeof window)return new Promise((s,i)=>{const e=new Image;e.onload=(()=>{s(k.fromImage(e))}),e.onerror=(()=>{i(t)}),e.src=t});throw console.log(require("fs")),new Error("Bitmap.fromFile() not implemented for node yet")}}class I{constructor(t,s,i){this._y_start=Math.ceil(t.ndc.y),this._y_end=Math.ceil(s.ndc.y),this._interpolator=i,this._varyings=new Map,this._varying_names=[...i.varyings.keys()],this._from=t,this._to=s;const e=this._y_start-t.ndc.y;this._x_step=(t.ndc.x-s.ndc.x)/(t.ndc.y-s.ndc.y),this._x=t.ndc.x+e*this._x_step;const h=this._x-t.ndc.x;for(let s=0;s<this._varying_names.length;s++){const r=this._varying_names[s],n=i.varyings.get(r);this._varyings.set(r,{current:A(A(i.VAO.varyings.get(r)[t.index],n.x_step,h),n.y_step,e),step:A(n.y_step,n.x_step,this._x_step)})}}step(){this._x+=this._x_step;for(let t=0;t<this._varying_names.length;t++){const s=this._varying_names[t],i=this._varyings.get(s);i.current=z(i.current,i.step)}}get x(){return this._x}get y_start(){return this._y_start}get y_end(){return this._y_end}get from(){return this._from}get to(){return this._to}get varyings(){return this._varyings}get gradient(){return this._interpolator}}class F{constructor(t,...s){this._varyings=new Map,this._vertices=s,this._VAO=t}stepX(t){return t.current=z(t.current,t.x_step)}get varyings(){return this._varyings}get VAO(){return this._VAO}}class V extends F{constructor(t,s,i){super(i,t,s),this._inv_dx=1/(s.ndc.x-t.ndc.x),this._inv_dy=1/(s.ndc.y-t.ndc.y),this._computeGradients()}_computeGradients(){for(const t in this._vertices[0].varyings){const s=this._VAO.varyings.get(t),i=s[this._vertices[0].index],e=s[this._vertices[1].index];"number"==typeof i?this._varyings.set(t,this._computeFloatGradient(i,e)):this._varyings.set(t,this._computeVecGradient(i,e))}}_computeFloatGradient(t,s){return{x_step:(s-t)*this._inv_dx,y_step:(s-t)*this._inv_dy}}_computeVecGradient(t,s){return{x_step:s.sub(t).times(this._inv_dx),y_step:s.sub(t).times(this._inv_dy)}}}class S extends F{constructor(t,s,i,e){super(e,t,s,i),this._inv_dx=1/((s.ndc.x-i.ndc.x)*(t.ndc.y-i.ndc.y)-(t.ndc.x-i.ndc.x)*(s.ndc.y-i.ndc.y)),this._inv_dy=-this._inv_dx,this._computeGradients()}_computeGradients(){const t=this._vertices[0].ndc.w,s=this._vertices[1].ndc.w,i=this._vertices[2].ndc.w;for(const e in this._vertices[0].varyings){const h=this._VAO.varyings.get(e);"__ndc"!==e&&(h[this._vertices[0].index]=M(h[this._vertices[0].index],t),h[this._vertices[1].index]=M(h[this._vertices[1].index],s),h[this._vertices[2].index]=M(h[this._vertices[2].index],i));let r=h[this._vertices[0].index],n=h[this._vertices[1].index],_=h[this._vertices[2].index];"number"==typeof r?this._varyings.set(e,this._computeFloatGradient(r,n,_)):this._varyings.set(e,this._computeVecGradient(r,n,_))}}_computeFloatGradient(t,s,i){return{x_step:(s-i)*(this._vertices[0].ndc.y-this._vertices[2].ndc.y)-(t-i)*(this._vertices[1].ndc.y-this._vertices[2].ndc.y)*this._inv_dx,y_step:(s-i)*(this._vertices[0].ndc.x-this._vertices[2].ndc.x)-(t-i)*(this._vertices[1].ndc.x-this._vertices[2].ndc.x)*this._inv_dy}}_computeVecGradient(t,s,i){const e=this._vertices[0].ndc.y-this._vertices[2].ndc.y,h=this._vertices[1].ndc.y-this._vertices[2].ndc.y,r=s.sub(i),n=t.sub(i),_=r.times(e).sub(n.times(h)).times(this._inv_dx),m=this._vertices[0].ndc.x-this._vertices[2].ndc.x,a=this._vertices[1].ndc.x-this._vertices[2].ndc.x;return{x_step:_,y_step:r.times(m).sub(n.times(a)).times(this._inv_dy)}}}var O,G;!function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.TRIANGLES=2]="TRIANGLES"}(O||(O={}));class L extends k{constructor(t,s,i,e){super(t,s),this._target=i,this._initOptions(e),this._screen_space_matrix=n.screenSpace(t,s)}_initOptions(t={}){this._options=Object.assign({depth_test:!0,backface_culling:!0},t),void 0!==this._target.init&&this._target.init(this._width,this._height),this._options.depth_test&&(this._depth_buffer=new Float32Array(this._width*this._height),this._depth_buffer.fill(1/0))}_perspectiveTransform(t){const s=this._program.vertex_shader(t),i=this._screen_space_matrix.transform(s),e=new f(i.x/i.w,i.y/i.w,i.z/i.w,1/i.w);return t.varyings.__ndc=e,{ndc:e,varyings:t.varyings,index:t.index}}_shouldDrawFragment(t,s,i){if(this._options.depth_test){const e=t+s*this._width;if(i>this._depth_buffer[e])return!1;this._depth_buffer[e]=i}return!0}_scanLine(t,s,i){t=Math.ceil(t);const e=Math.ceil(s.x),h=Math.ceil(i.x),r=e-s.x;this._initVaryings(s,r),this._current_varyings={};const n=this._current_gradient.varyings.get("__ndc");let _;for(let s=e;s<h;s++){this._current_gradient.stepX(n),_=1/n.current.w;for(let t=0;t<this._current_varying_names.length;t++){const s=this._current_varying_names[t];if("__ndc"===s)continue;const i=this._current_gradient.varyings.get(s);this._current_varyings[s]=M(this._current_gradient.stepX(i),_)}this._shouldDrawFragment(s,t,n.current.z)&&this._set(s,t,this._program.fragment_shader(this._current_varyings,this._vertex_array.uniforms))}}_initVaryings(t,s){for(let i=0;i<this._current_varying_names.length;i++){const e=this._current_varying_names[i],h=this._current_gradient.varyings.get(e);h.current=z(t.varyings.get(e).current,M(h.x_step,s))}}_strokeEdge(t){const s=t.from,i=t.to,e=Math.ceil(s.ndc.x),h=Math.ceil(s.ndc.y),r=Math.ceil(i.ndc.x),n=Math.ceil(i.ndc.y),_=Math.abs(r-e),m=Math.abs(n-h),a=e<r?1:-1,o=h<n?1:-1;let c=_-m;this._current_gradient=t.gradient;const u=e-s.ndc.x;this._initVaryings(t,u);let d=e,l=h;const y={};for(;d!==r||l!==n;){for(const[t,s]of this._current_gradient.varyings)this._current_gradient.stepX(s),y[t]=s.current;const t=2*c;t>-m&&(c-=m,d+=a),t<_&&(c+=_,l+=o)}}_drawLines(t,s){for(let i=t;i<t+s;i+=2){const t=this._perspectiveTransform(this._vertex_array.at(i)),s=this._perspectiveTransform(this._vertex_array.at(i+1));this._strokeEdge(new I(t,s,new V(t,s,this._vertex_array)))}}_drawLinesIndexed(t,s){const i=this._vertex_array.indices;for(let e=t;e<t+s;e+=2){const t=this._perspectiveTransform(this._vertex_array.at(i[e])),s=this._perspectiveTransform(this._vertex_array.at(i[e+1]));this._strokeEdge(new I(t,s,new V(t,s,this._vertex_array)))}}_drawTriangles(t,s,i){for(let e=t;e<t+s;e+=3){const t=this._perspectiveTransform(this._vertex_array.at(e)),s=this._perspectiveTransform(this._vertex_array.at(e+1)),h=this._perspectiveTransform(this._vertex_array.at(e+2));i?this._strokeTriangle(t,s,h):this._fillTriangle(t,s,h)}}_drawTrianglesIndexed(t,s,i){const e=this._vertex_array.indices;for(let h=t;h<t+s;h+=3){const t=this._perspectiveTransform(this._vertex_array.at(e[h])),s=this._perspectiveTransform(this._vertex_array.at(e[h+1])),r=this._perspectiveTransform(this._vertex_array.at(e[h+2]));i?this._strokeTriangle(t,s,r):this._fillTriangle(t,s,r)}}_strokeTriangle(t,s,i){this._strokeEdge(new I(t,s,new V(t,s,this._vertex_array))),this._strokeEdge(new I(t,i,new V(t,i,this._vertex_array))),this._strokeEdge(new I(s,i,new V(s,i,this._vertex_array)))}_fillTriangle(t,s,i){if(this._options.backface_culling&&b(t.ndc,s.ndc,i.ndc)<0)return;let e=!1;i.ndc.y<s.ndc.y&&([i,s]=[s,i],e=!e),s.ndc.y<t.ndc.y&&([s,t]=[t,s],e=!e),i.ndc.y<s.ndc.y&&([i,s]=[s,i],e=!e);const h=new S(t,s,i,this._vertex_array);this._current_gradient=h,this._current_varying_names=[...this._current_gradient.varyings.keys()];const r=new I(t,i,h);this._scanEdges(r,new I(t,s,h),e),this._scanEdges(r,new I(s,i,h),e)}_scanEdges(t,s,i){let e=t,h=s;const r=s.y_start,n=s.y_end;i&&([e,h]=[h,e]);for(let t=r;t<n;t++)this._scanLine(t,e,h),e.step(),h.step()}drawArrays(t,s,i,e=!1){switch(t){case O.LINES:this._drawLines(s,i);break;case O.TRIANGLES:this._drawTriangles(s,i,e);break;default:throw new Error(`Drawing mode ${t} not implemented yet`)}this.draw()}drawElements(t,s,i,e=!1){if(!this._vertex_array.indexed)throw new Error("Cannot draw elements: indices not defined in bound vertex array");switch(t){case O.LINES:this._drawLinesIndexed(s,i);break;case O.TRIANGLES:this._drawTrianglesIndexed(s,i,e);break;default:throw new Error(`Drawing mode ${t} not implemented yet`)}this.draw()}useProgram(t){this._program=t}bindVertexArray(t){this._vertex_array=t}_clearDepthBuffer(){this._options.depth_test&&this._depth_buffer.fill(1/0)}clearBuffers(){this._clearDepthBuffer()}draw(){this._target.draw(this)}get options(){return this._options}}class D{constructor(){this.last_tick=Date.now()}getDelta(){const t=Date.now(),s=t-this.last_tick;return this.last_tick=t,s}}!function(t){const s=t=>{const s=t.substr(2).split(" ").map(t=>parseFloat(t));return new h(s[0],1-s[1],s[2])},i=t=>{const s=t.substr(3).split(" ").map(t=>parseFloat(t));return new e(s[0],s[1])},r=t=>{const s=t.substr(3).split(" ").map(t=>parseFloat(t));return new h(s[0],s[1],s[2])};(G||(G={})).parseOBJ=(t=>{const e=t.split("\n"),h=[],n=[],_=[],a=[],o=new Map;let c=0;const u={vertices:[],indices:null,attributes:{uv:[],normal:[]},bounding_box:{min:m(1/0),max:m(0)}};for(let t of e)switch((t=t.trim()).charAt(0)){case"v":switch(t.charAt(1)){case" ":const e=s(t);e.x>u.bounding_box.max.x&&(u.bounding_box.max.x=e.x),e.y>u.bounding_box.max.y&&(u.bounding_box.max.y=e.y),e.z>u.bounding_box.max.z&&(u.bounding_box.max.z=e.z),e.x<u.bounding_box.min.x&&(u.bounding_box.min.x=e.x),e.y<u.bounding_box.min.y&&(u.bounding_box.min.y=e.y),e.z<u.bounding_box.min.z&&(u.bounding_box.min.z=e.z),h.push(e);break;case"t":n.push(i(t));break;case"n":_.push(r(t))}break;case"f":const e=t.substr(2).split(" ");let m=[];for(const t of e){if(o.has(t)){m.push(o.get(t));continue}const[s,i,e]=t.split("/").map(t=>parseInt(t)-1);u.vertices.push(h[s]),void 0!==i&&u.attributes.uv.push(n[i]),void 0!==e&&u.attributes.normal.push(_[e]),o.set(t,c),m.push(c),c++}if(4===e.length){const t=m[3];m[3]=m[2],m[4]=t,m[5]=m[0]}a.push(...m)}return u.indices=c<256?new Uint8Array(a):c<65536?new Uint16Array(a):new Uint32Array(a),u})}();const N=(t,s)=>t.at(Math.floor(s.x*t.width),Math.floor(s.y*t.height));class P{constructor(t){this._vertices=t,this._attributes=new Map,this._varyings=new Map,this._uniforms={},this._current_idx=0,this._attribute_accessor=new Proxy({},{get:(t,s)=>{const i=this._attributes.get(s)[this._current_idx];if(void 0===i)throw new Error(`Undefined attribute: ${s}`);return i}}),this._varying_setter=new Proxy({},{set:(t,s,i)=>{const e=this._varyings.get(s);if(void 0===e){const t=[];t[this._current_idx]=i,this._varyings.set(s,t)}else e[this._current_idx]=i;return t[s]=i,!0}})}at(t){return this._current_idx=t,{position:this._vertices[t],attributes:this._attribute_accessor,uniforms:this._uniforms,varyings:this._varying_setter,index:t}}addAttribute(t,s){if(s.length<this._vertices.length)throw new Error(`Not enough data for attribute ${t}`);this._attributes.set(t,s)}setUniform(t,s){this._uniforms[t]=s}indexed(){return void 0!==this._indices}get indices(){return this._indices}set indices(t){this._indices=t}get varyings(){return this._varyings}get uniforms(){return this._uniforms}static fromModel(t){const s=new P(t.vertices);void 0!==t.indices&&(s.indices=t.indices);for(const i in t.attributes){const e=t.attributes[i];void 0!==e&&0!==e.length&&s.addAttribute(i,e)}return s}}i.d(s,"Bitmap",function(){return k}),i.d(s,"DrawingMode",function(){return O}),i.d(s,"Context",function(){return L}),i.d(s,"Edge",function(){return I}),i.d(s,"Clock",function(){return D}),i.d(s,"hexToColor",function(){return g}),i.d(s,"colors",function(){return x}),i.d(s,"degrees",function(){return w}),i.d(s,"radians",function(){return v}),i.d(s,"clamp",function(){return p}),i.d(s,"parallelogramArea",function(){return b}),i.d(s,"interpolableAdd",function(){return z}),i.d(s,"interpolableTimes",function(){return M}),i.d(s,"interpolableMul",function(){return T}),i.d(s,"interpolableAddTimes",function(){return A}),i.d(s,"fillSequence",function(){return E}),i.d(s,"Matrix4",function(){return n}),i.d(s,"ModelLoader",function(){return G}),i.d(s,"texture",function(){return N}),i.d(s,"Vec2",function(){return e}),i.d(s,"Vec3",function(){return h}),i.d(s,"Vec4",function(){return f}),i.d(s,"VecN",function(){return r}),i.d(s,"vec2",function(){return _}),i.d(s,"vec3",function(){return m}),i.d(s,"vec4",function(){return a}),i.d(s,"vecn",function(){return o}),i.d(s,"vec",function(){return c}),i.d(s,"mat4",function(){return u}),i.d(s,"EPS",function(){return d}),i.d(s,"swizzle",function(){return y}),i.d(s,"VaryingInterpolator",function(){return F}),i.d(s,"VaryingInterpolator2",function(){return V}),i.d(s,"VaryingInterpolator3",function(){return S}),i.d(s,"VertexArray",function(){return P})}])});